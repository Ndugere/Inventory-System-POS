{% extends "posApp/base.html" %}
{% load humanize %}
{% block pageContent %}
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
    <div class="mdc-card py-2">
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="card-title mb-0">Inventory</h4>
            <ul class="nav flex-row">
                <li class="nav-item">
                    <a class="nav-link active" href="{% url 'inventory' %}">
                        Inventory
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="{% url 'stocks-page' %}">
                        Stock
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'product-page' %}">
                        Products
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'category-page' %}">
                        Categories
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'supplier-page' %}">
                        Suppliers
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-6">
    <div class="mdc-card py-2">        
            <div class="mt-4">
                <h5>Expiring Soon Stocks</h5>
                <canvas id="expiringSoonChart"></canvas>
            </div>
    </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-6">
    <div class="mdc-card py-2">
            <div class="mt-4">
                <h5>Low Stock Levels</h5>
                <canvas id="lowStockChart"></canvas>
            </div>
    </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-6">
    <div class="mdc-card py-2">
        <div class="mt-4">
            <h5>Top-Selling Products</h5>
            <canvas id="topSellingChart"></canvas>
        </div>
    </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-6">
    <div class="mdc-card py-2">
        <div class="mt-4">
            <h5>Stock Value by Category</h5>
            <canvas id="stockValueChart"></canvas>
        </div>
    </div>
</div>
{% endblock pageContent %}

{% block ScriptBlock %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Fetch data for Expiring Soon Stocks
    fetch("{% url 'inventory_data' %}?type=expiring_soon")
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('expiringSoonChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.products,
                    datasets: [{
                        label: 'Expiring Soon (Quantity)',
                        data: data.quantities,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Expiring Soon Stocks' }
                    }
                }
            });
        });

    // Fetch data for Low Stocks
    fetch("{% url 'inventory_data' %}?type=low_stock")
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('lowStockChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.products,
                    datasets: [{
                        label: 'Low Stock (Quantity)',
                        data: data.quantities,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Low Stock Levels' }
                    }
                }
            });
        });

    // Fetch data for Top-Selling Products
    fetch("{% url 'inventory_data' %}?type=top_selling")
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('topSellingChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.products,
                    datasets: [{
                        label: 'Units Sold',
                        data: data.quantities,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Top-Selling Products' }
                    }
                }
            });
        });

    // Fetch data for Stock Value by Category
    fetch("{% url 'inventory_data' %}?type=stock_value")
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('stockValueChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.categories,
                    datasets: [{
                        label: 'Stock Value',
                        data: data.values,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Stock Value by Category' }
                    }
                }
            });
        });
</script>
{% endblock ScriptBlock %}
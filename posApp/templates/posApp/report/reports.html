{% extends 'posApp/base.html' %}
{% load static %}

{% block pageContent %}
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
    <div class="mdc-card py-2">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">Sales & Inventory Reports</h3>
        </div>
    </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
    <div class="mdc-card py-2">
        <!-- Filters Section -->
        <form id="reports-filter-form" class="row">
            <!-- Single Day Picker -->
            <div class="col-md-3 mb-3">
            <label for="report-date" class="control-label">Select Day</label>
            <input type="date" class="form-control form-control-sm rounded-0" id="report-date" name="report_date">
            </div>
            <!-- Date Range Pickers -->
            <div class="col-md-3 mb-3">
            <label for="start-date" class="control-label">Start Date</label>
            <input type="date" class="form-control form-control-sm rounded-0" id="start-date" name="start_date">
            </div>
            <div class="col-md-3 mb-3">
            <label for="end-date" class="control-label">End Date</label>
            <input type="date" class="form-control form-control-sm rounded-0" id="end-date" name="end_date">
            </div>
            <div class="col-md-3 pt-6 text-center">
            <button type="submit" class="btn btn-primary btn-sm">Generate Report</button>
            </div>
        </form>
    </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-6">
    <div class="mdc-card">
        <div class="container">
            <!-- Revenue Breakdown -->
            <div class="bg-white p-4 shadow-lg rounded-lg">
                <h4 class="text-lg font-semibold">Revenue Breakdown</h4>
                <canvas id="revenueBreakdownChart"></canvas>
            </div>
        </div>
    </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-6">
    <div class="mdc-card">
        <div class="container">            
            <!-- Sales Trends -->
            <div class="bg-white p-4 shadow-lg rounded-lg">
                <h4 class="text-lg font-semibold">Sales Trends</h4>
                <canvas id="salesTrendChart"></canvas>
            </div>
        </div>
    </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-6">
    <div class="mdc-card">
        <div class="container">            
            <!-- Top Selling Products -->
            <div class="bg-white p-4 shadow-lg rounded-lg">
                <h4 class="text-lg font-semibold">Top Selling Products</h4>
                <canvas id="topSellingChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-6">
    <div class="mdc-card">
        <div class="container">            
            <!-- Stock Levels -->
            <div class="bg-white p-4 shadow-lg rounded-lg">
                <h4 class="text-lg font-semibold">Stock Levels</h4>
                <canvas id="stockLevelsChart"></canvas>
            </div>
        </div>
    </div>
</div>
<div class="container mx-auto p-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Sales Trends -->
        <!--div class="bg-white p-4 shadow-lg rounded-lg">
            <h2 class="text-lg font-semibold">Sales Trends</h2>
            <canvas id="salesTrendChart"></canvas>
        </div-->
        
        <!-- Revenue Breakdown -->
        <!--div class="bg-white p-4 shadow-lg rounded-lg">
            <h2 class="text-lg font-semibold">Revenue Breakdown</h2>
            <canvas id="revenueBreakdownChart"></canvas>
        </div-->
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <!-- Top Selling Products -->
        <!--div class="bg-white p-4 shadow-lg rounded-lg">
            <h2 class="text-lg font-semibold">Top Selling Products</h2>
            <canvas id="topSellingChart"></canvas>
        </div-->
        
        <!-- Stock Levels -->
        <!--div class="bg-white p-4 shadow-lg rounded-lg">
            <h2 class="text-lg font-semibold">Stock Levels</h2>
            <canvas id="stockLevelsChart"></canvas>
        </div-->
    </div>
</div>

<script src="{% static 'posApp/assets/default/js/chart.min.js'%}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
            fetch("{% url 'reports_data' %}")
            .then(response => response.json())
            .then(data => {
                // Sales Trends Chart
                new Chart(document.getElementById("salesTrendChart"), {
                    type: "line",
                    data: {
                        labels: data.sales_trends.dates,
                        datasets: [{
                            label: "Sales Revenue",
                            data: data.sales_trends.amounts,
                            borderColor: "#0c8959",
                            fill: true
                        }]
                    }
                });
                
                // Revenue Breakdown Chart
                new Chart(document.getElementById("revenueBreakdownChart"), {
                    type: "pie",
                    data: {
                        labels: ["Cash", "Mpesa"],
                        datasets: [{
                            data: data.revenue_breakdown,
                            backgroundColor: ["#2196F3", "#FF9800"]
                        }]
                    },
                    options:{
                        legend: {
                            position: "bottom",
                        },
                    }
                });
                
                // Top Selling Products Chart
                new Chart(document.getElementById("topSellingChart"), {
                    type: "bar",
                    data: {
                        labels: data.top_selling.products,
                        datasets: [{
                            label: "Units Sold",
                            data: data.top_selling.quantities,
                            backgroundColor: "#673AB7"
                        }]
                    }
                });
                
                // Stock Levels Chart
                new Chart(document.getElementById("stockLevelsChart"), {
                    type: "bar",
                    data: {
                        labels: data.stock_levels.products,
                        datasets: [{
                            label: "Stock Available",
                            data: data.stock_levels.quantities,
                            backgroundColor: "#E91E63"
                        }]
                    }
                });
            });
    });

</script>
{% endblock %}
